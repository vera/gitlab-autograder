# GitLab Autograder: Scripts

**Für die deutsche Version von diesem README [klick hier](README.md).**

## `step1_create_submission_groups.py`

This script can be used to automatically create the “Submissions” subgroups. For this a CSV file is needed, which contains one row per group. Currently, this file is expected to contain the columns “Vorname”, “Nachname” and “E-Mail-Adresse” as generated by German Moodle. These columns are used to name the group. However, the script can easily be modified to expect other columns or to name the groups differently.

The following values need to be replaced in the script:

- `<YOUR_CSV_FILE>` (path of the CSV file)
- `<YOUR_SUBMISSION_GROUP_ID>` (ID of the group “Submissions”)
- `<YOUR_GITLAB_TOKEN>` (GitLab token that allows to create subgroups)
- `<YOUR_GITLAB_URL>` (URL of the GitLab instance)

## `step2_add_members_to_submission_groups.py`

This script can be used to automatically add members to “Submissions” subgroups. The script is currently designed to give each group only one member, and the name of the member is found in the “path” attribute of the group (this is the case if the group was created using the script from above). Unfortunately, since the GitLab instance used did not provide a way to uniquely identify and search for a user, the script outputs all candidate GitLab users on the standard output and then expects user input to confirm. The user is only added if the input is “y”. Whether the user is the correct one must be checked manually.

The following values must be replaced in the script:

- `<YOUR_SUBMISSION_GROUP_ID>` (ID of the group "Submissions")
- `<YOUR_GITLAB_TOKEN>` (GitLab token that allows to create subgroups)
- `<YOUR_GITLAB_URL>` (URL of the GitLab instance)

## `step3_create_forks.py` and `step3_create_forks.sh`

This Python script can be used to fork a task repository into all “Submissions” subgroups. The IDs of the “Submissions” group and the project to be forked are expected as program parameters (i.e. a call should look like this: `python3 create_forks.py <SUBMISSION_GROUP_ID> <PROJECT_TO_FORK>`).

The following values need to be replaced in the script:

- `<YOUR_GITLAB_TOKEN>` (GitLab token that allows subgroup creation)
- `<YOUR_GITLAB_URL>` (URL of the GitLab instance)

The script can be used in a cronjob to automatically release tasks on a specific date. For this purpose there is an additional shell script `step3_create_forks.sh`. To use this script with cron, you have to create a virtual environment in Python in `.venv` before (`python3 -m venv .venv`) and install the package `requests` in it. Then this script can be used in cronjobs, e.g. like this:

```
00 00 19 05 * <YOUR_SCRIPT_PATH>/create_forks.sh <YOUR_SUBMISSION_GROUP_ID> <YOUR_PROJECT_TO_FORK>
```

This line must be entered into the cron table. This can be edited e.g. with the command `crontab -e`. Time, date, path to the .sh file and the group IDs have to be adjusted of course.

The script creates a log file.

The following values must be replaced in the shell script:

- `<YOUR_SCRIPT_PATH>` (path of the Python script and the venv)
- `<YOUR_LOG_PATH>` (path where the log file should be created)

(Both paths can match.)

## `step4_gather_results.py`

This script can be used to export the results of a single programming task from GitLab. The script prints the exported results to standard output and also stores them in a SQLite3 database (a SQL database consisting of a single file) for further use. The script expects the task number as a program parameter. It also expects the task repositories to be named according to the scheme "`<NUMBER>. <NAME>`", so that their paths are "`<NUMBER>-<NAME>`". If this is not the case, line 46 must be adjusted.

The following values must be replaced in the script:

- `<YOUR_GITLAB_TOKEN>` (GitLab token that allows the creation of subgroups).
- `<YOUR_GITLAB_URL>` (URL of the GitLab instance)
- `<YOUR_DB_FILE_PATH>` (path where the SQLite3 database should be created)

## `step5_generate_pass_fail_csv.py`

This script can be used to evaluate the final results of all programming tasks. It checks if a minimum number of programming tasks has been successfully solved. To do this, each individual programming task must first have been evaluated with the `step4_gather_results.py` script described above. The script outputs the results on the standard output in CSV format. They can be redirected to a CSV file, for example, and then imported into Moodle.

The following values must be replaced in the script:

- `<YOUR_DB_FILE_PATH>` (path where the SQLite3 database with the results of the tasks is located)
- `<EXERCISES_REQUIRED_TO_PASS>` (number of tasks that must be successfully solved for passing)
- `<EMAIL_SUFFIX>` (suffix to be appended to user names (e.g. required for Moodle import); can also be empty)
